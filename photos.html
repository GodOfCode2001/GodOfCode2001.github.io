<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <!-- ä¿è¯ç§»åŠ¨è®¾å¤‡ä¸Šæ­£ç¡®ç¼©æ”¾ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç…§ç‰‡é›†</title>
  <style>
    /* åŸºæœ¬é¡µé¢è®¾ç½® */
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
      width: 100%;
      height: 100%;
    }
    /* ä¸»å®¹å™¨å…¨å± */
    .container {
      position: relative;
      width: 100%;
      height: 100vh;
      overflow: hidden;
      background-color: pink;
    }
    /* ç…§ç‰‡å•å…ƒï¼Œå®½é«˜ç”± JS åŠ¨æ€è®¾ç½® */
    .photo-cell {
      position: absolute;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      /* CSS åŠ¨ç”»ï¼Œä»åº•éƒ¨ä¸Šå‡åˆ°é¡µé¢é¡¶éƒ¨ */
      animation: rise 6s linear forwards;
    }
    /* åŠ¨ç”»ç»ˆç‚¹ä½¿ç”¨ CSS å˜é‡ --endTop */
    @keyframes rise {
      from { top: 100vh; }
      to { top: var(--endTop); }
    }
    /* ç¢ç‰‡æ ·å¼ */
    .fragment {
      position: absolute;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      animation: shatter 2.5s forwards;
    }
    @keyframes shatter {
      0% {
        transform: translate(0,0) rotate(0deg) scale(1);
        opacity: 1;
      }
      100% {
        /* ç»“åˆ CSS å˜é‡å®ç°éšæœºåç§»ã€æ—‹è½¬ã€ç¼©æ”¾åŠé¢å¤–ä¸Šç§» 50px */
        transform: translate(calc(var(--dx)), calc(var(--dy) - 50px)) rotate(var(--rotate)) scale(0.5);
        opacity: 0;
      }
    }
    /* éšè—éŸ³é¢‘æ§ä»¶ */
    audio {
      position: absolute;
      left: -9999px;
    }
    /* éŸ³ä¹æ§åˆ¶å›¾æ ‡æ ·å¼ */
    #music-control {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 24px;
      color: #fff;
      z-index: 1000;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>
  <!-- ä¸»å®¹å™¨ -->
  <div class="container" id="container"></div>
  <!-- éŸ³ä¹æ§åˆ¶å›¾æ ‡ -->
  <div id="music-control">ğŸµ</div>
  <audio playsinline loop preload="auto" autoplay src="./video/qifengle.mp3" id="myAudio"></audio>
  <script>
    // å›¾ç‰‡æ‰€åœ¨ç›®å½•åŠå›¾ç‰‡åˆ—è¡¨
    const imageFolder = './images/';
    const images = [
      'psc0.jpg', 'psc1.jpg', 'psc2.jpg', 'psc3.jpg', 'psc4.jpg', 'psc5.jpg',
      'psc6.jpg', 'psc7.jpg', 'psc8.jpg', 'psc9.jpg', 'psc10.jpg', 'psc11.jpg',
      'psc12.jpg', 'psc13.jpg', 'psc14.jpg', 'psc15.jpg', 'psc16.jpg', 'psc17.jpg',
      'psc18.jpg', 'psc19.jpg', 'psc20.jpg', 'psc21.jpg', 'psc22.jpg', 'psc23.jpg',
      'psc24.jpg', 'psc25.jpg', 'psc26.jpg', 'psc27.jpg', 'psc28.jpg', 'psc29.jpg',
      'psc30.jpg'
    ];
    let imageIndex = 0;
    function getNextImage() {
      const img = imageFolder + images[imageIndex];
      imageIndex = (imageIndex + 1) % images.length;
      return img;
    }
    // æ ¹æ®å½“å‰çª—å£å®½åº¦è®¡ç®—ç…§ç‰‡å•å…ƒå°ºå¯¸ï¼ˆå®½åº¦å æ¯” 20%ï¼Œå¹¶åœ¨ [100,300]px èŒƒå›´å†…ï¼‰
    function getCellDimensions() {
      const scaleFactor = 0.2;
      let width = window.innerWidth * scaleFactor;
      width = Math.max(100, Math.min(width, 300));
      let height = width * 1.25; // ä¿æŒ 4:5 æ¯”ä¾‹
      return { width, height };
    }
    const container = document.getElementById('container');
    // ç”Ÿæˆä¸€ä¸ªç…§ç‰‡å•å…ƒï¼Œè®¾ç½®éšæœºæ°´å¹³ä½ç½®ã€èƒŒæ™¯å›¾ç‰‡åŠåŠ¨ç”»ç»ˆç‚¹
    function spawnPhoto() {
      const { width, height } = getCellDimensions();
      const cell = document.createElement('div');
      cell.className = 'photo-cell';
      cell.style.width = width + 'px';
      cell.style.height = height + 'px';
      // è®¾ç½®ä¸Šå‡åŠ¨ç”»ç»ˆç‚¹ä¸ºè´Ÿçš„å½“å‰é«˜åº¦
      cell.style.setProperty('--endTop', `-${height}px`);
      // éšæœºè®¾ç½®æ°´å¹³ä½ç½®ï¼ˆç¡®ä¿ä¸è¶…å‡ºé¡µé¢ï¼‰
      const maxLeft = window.innerWidth - width;
      const left = Math.random() * maxLeft;
      cell.style.left = left + 'px';
      // è®¾ç½®èƒŒæ™¯å›¾ç‰‡
      cell.style.backgroundImage = `url(${getNextImage()})`;
      container.appendChild(cell);
      // 5ç§’åè§¦å‘ç ´ç¢æ•ˆæœ
      setTimeout(() => {
        triggerFragment(cell);
      }, 5000);
      // 8ç§’åç§»é™¤å•å…ƒï¼ˆä¸Šå‡åŠ¨ç”»ç»“æŸï¼‰
      setTimeout(() => {
        if (cell.parentNode) {
          cell.parentNode.removeChild(cell);
        }
      }, 8000);
    }
    // å°†å•å…ƒæ‹†åˆ†ä¸ºç¢ç‰‡å¹¶ç‹¬ç«‹ä¸Šå‡æ¸éš
    function triggerFragment(cell) {
      const rect = cell.getBoundingClientRect();
      const containerRect = container.getBoundingClientRect();
      const cellLeft = rect.left - containerRect.left;
      const cellTop = rect.top - containerRect.top;
      const cellWidth = cell.offsetWidth;
      const cellHeight = cell.offsetHeight;
      const bgImage = cell.style.backgroundImage;
      // ç§»é™¤åŸå•å…ƒï¼Œä»¥ä¾¿ç¢ç‰‡ç‹¬ç«‹æ˜¾ç¤º
      if(cell.parentNode) {
         cell.parentNode.removeChild(cell);
      }
      // æŒ‰ 4x4 ç½‘æ ¼æ‹†åˆ†æˆ 16 ä¸ªç¢ç‰‡
      const rows = 4, cols = 4;
      for (let r = 0; r < rows; r++){
        for (let c = 0; c < cols; c++){
          const frag = document.createElement('div');
          frag.className = 'fragment';
          const fragWidth = cellWidth / cols;
          const fragHeight = cellHeight / rows;
          frag.style.width = fragWidth + 'px';
          frag.style.height = fragHeight + 'px';
          // è®¡ç®—ç¢ç‰‡åœ¨æ•´ä¸ªå®¹å™¨ä¸­çš„ä½ç½®
          frag.style.left = (cellLeft + c * fragWidth) + 'px';
          frag.style.top = (cellTop + r * fragHeight) + 'px';
          // è£å‰ªæ˜¾ç¤ºå›¾ç‰‡çš„å¯¹åº”éƒ¨åˆ†
          frag.style.backgroundImage = bgImage;
          frag.style.backgroundSize = `${cellWidth}px ${cellHeight}px`;
          frag.style.backgroundPosition = `-${c * fragWidth}px -${r * fragHeight}px`;
          // éšæœºç”Ÿæˆåç§»å’Œæ—‹è½¬å‚æ•°ä¼ é€’ç»™åŠ¨ç”»
          const dx = (Math.random() * 50 - 25) + 'px';
          const dy = (Math.random() * 50 - 25) + 'px';
          const rotate = (Math.random() * 60 - 30) + 'deg';
          frag.style.setProperty('--dx', dx);
          frag.style.setProperty('--dy', dy);
          frag.style.setProperty('--rotate', rotate);
          // éšæœºå»¶è¿Ÿä½¿æ•ˆæœæ›´è‡ªç„¶
          frag.style.animationDelay = (Math.random() * 0.3) + 's';
          container.appendChild(frag);
          // åŠ¨ç”»ç»“æŸåç§»é™¤ç¢ç‰‡
          setTimeout(() => {
            if (frag.parentNode) {
              frag.parentNode.removeChild(frag);
            }
          }, 3000);
        }
      }
    }
    // æ¯éš” 900 æ¯«ç§’ç”Ÿæˆä¸€ä¸ªæ–°çš„ç…§ç‰‡å•å…ƒï¼Œå½¢æˆæºæºä¸æ–­çš„ä¸Šå‡æ•ˆæœ
    setInterval(spawnPhoto, 900);

    // éŸ³é¢‘æ§åˆ¶é€»è¾‘
    var myAudio = document.getElementById('myAudio');
    var musicControl = document.getElementById('music-control');

    // é’ˆå¯¹å®‰å“è®¾å¤‡è‡ªåŠ¨æ’­æ”¾ï¼ˆè‹¹æœè®¾å¤‡é€šå¸¸æ— æ³•åœ¨æ— äº¤äº’ä¸‹è‡ªåŠ¨æ’­æ”¾å¸¦å£°éŸ³çš„éŸ³é¢‘ï¼‰
    if (/Android/i.test(navigator.userAgent)|| /HUAWEI/i.test(navigator.userAgent)) {
      myAudio.muted = false; // ç¡®ä¿ä¸é™éŸ³
      myAudio.play().then(() => {
        musicControl.textContent = 'ğŸµ';
      }).catch(err => {
        console.log('å®‰å“è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼š', err);
      });
    }

    // éŸ³ä¹æ§åˆ¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼šåˆ‡æ¢æ’­æ”¾/æš‚åœ
    musicControl.addEventListener('click', function() {
      if (myAudio.paused) {
        myAudio.play().then(() => {
          musicControl.textContent = 'ğŸµ';
        }).catch(err => {
          console.log('æ’­æ”¾å¤±è´¥ï¼š', err);
        });
      } else {
        myAudio.pause();
        musicControl.textContent = 'ğŸ”‡';
      }
    });
  </script>
</body>
</html>
